<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢˜ç›®è¯¦æƒ… - ACMä¸­è½¬ç«™</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/solutions.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="navbar-brand">ACMä¸­è½¬ç«™</a>
            <ul class="navbar-nav">
                <li><a href="index.html">ä»ªè¡¨æ¿</a></li>
                <li><a href="contests.html">æ¯”èµ›ç®¡ç†</a></li>
                <li><a href="problems.html">é¢˜ç›®ç®¡ç†</a></li>
            </ul>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- è¿”å›æŒ‰é’® -->
        <div class="page-header">
            <div class="flex items-center gap-3">
                <button class="btn btn-outline btn-sm" onclick="goBack()">â† è¿”å›é¢˜ç›®åˆ—è¡¨</button>
                <div>
                    <h1 class="page-title" id="problem-title">é¢˜ç›®è¯¦æƒ…</h1>
                    <p class="page-subtitle" id="problem-info">åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- é¢˜ç›®åŸºæœ¬ä¿¡æ¯ -->
        <div class="card" id="problem-details">
            <div class="card-header">
                <h2 class="card-title">é¢˜ç›®ä¿¡æ¯</h2>
                <div class="card-actions">
                    <button class="btn btn-outline btn-sm" onclick="editProblem()">ç¼–è¾‘é¢˜ç›®</button>
                    <button class="btn btn-sm" id="status-toggle-btn" onclick="toggleStatus()">
                        <!-- åŠ¨æ€è®¾ç½® -->
                    </button>
                </div>
            </div>
            <div class="form-container">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">é¢˜ç›®å¹³å°</label>
                        <div class="form-value">
                            <span class="tag" id="problem-platform">-</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">é¢˜ç›®ç¼–å·</label>
                        <div class="form-value" id="problem-index">-</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">éš¾åº¦å€¼</label>
                        <div class="form-value" id="problem-difficulty">-</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">è§£å†³çŠ¶æ€</label>
                        <div class="form-value" id="problem-status-display">
                            <!-- åŠ¨æ€è®¾ç½® -->
                        </div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">é¢˜ç›®é“¾æ¥</label>
                        <div class="form-value" id="problem-url-display">
                            <a href="#" id="problem-url-link" target="_blank" style="display: none;">æ‰“å¼€é¢˜ç›®é¡µé¢</a>
                            <span id="problem-url-empty">æ— </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ‰€å±æ¯”èµ›</label>
                        <div class="form-value" id="problem-contest-display">
                            <a href="#" id="problem-contest-link" style="display: none;">æŸ¥çœ‹æ¯”èµ›</a>
                            <span id="problem-contest-empty">æ— </span>
                        </div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">é¢˜ç›®æ–‡ä»¶</label>
                        <div class="form-value" id="problem-files-display">
                            <div id="problem-files-container">æ­£åœ¨åŠ è½½æ–‡ä»¶...</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">é¢˜è§£æ–‡ä»¶</label>
                        <div class="form-value" id="solution-files-display">
                            <div id="solution-files-container">æ­£åœ¨åŠ è½½é¢˜è§£...</div>
                        </div>
                    </div>
                </div>
                <div class="form-group" id="problem-tags-section" style="display: none;">
                    <label class="form-label">æ ‡ç­¾</label>
                    <div class="form-value">
                        <div id="problem-tags-display" class="tags-container">
                            <!-- åŠ¨æ€åŠ è½½æ ‡ç­¾ -->
                        </div>
                    </div>
                </div>
                <div class="form-group" id="problem-notes-section" style="display: none;">
                    <label class="form-label">å¤‡æ³¨</label>
                    <div class="form-value" id="problem-notes-display"></div>
                </div>
                <div class="form-group" id="problem-times-section" style="display: none;">
                    <label class="form-label">æ—¶é—´ä¿¡æ¯</label>
                    <div class="form-value">
                        <div class="time-info">
                            <div>æ·»åŠ æ—¶é—´: <span id="problem-added-time">-</span></div>
                            <div id="problem-solved-time-row" style="display: none;">
                                è§£å†³æ—¶é—´: <span id="problem-solved-time">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¢˜è§£ç®¡ç† -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">é¢˜è§£ç®¡ç†</h2>
                <div class="card-actions">
                    <button class="btn btn-primary btn-sm" onclick="openSolutionManager()">
                        ğŸ“ ç®¡ç†é¢˜è§£æ–‡ä»¶
                    </button>
                </div>
            </div>
            <div class="form-container">
                <div id="solutions-container">
                    <!-- é¢˜è§£åˆ—è¡¨å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
                </div>
            </div>
        </div>

        <!-- ç›¸å…³æ“ä½œ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">å¿«é€Ÿæ“ä½œ</h2>
            </div>
            <div class="form-container">
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="createSolutionTemplate()">ç”Ÿæˆé¢˜è§£æ¨¡æ¿</button>
                    <button class="btn btn-outline" onclick="copyProblemInfo()">å¤åˆ¶é¢˜ç›®ä¿¡æ¯</button>
                    <button class="btn btn-outline" onclick="addToCustomContest()">æ·»åŠ åˆ°è‡ªå®šä¹‰æ¯”èµ›</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½ JavaScript -->
    <script src="js/storage.js"></script>
    <script src="js/contest-generator.js"></script>
    <script src="js/problems.js"></script>
    <script src="js/contests.js"></script>
    <script src="js/solution-manager.js"></script>
    <script src="js/search.js"></script>
    <script src="js/file-manager.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let storage, problemManager, contestManager, globalSearch;
        let currentProblem = null;
        let problemId = null;

        // ä»URLè·å–é¢˜ç›®ID
        function getProblemIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                problemId = getProblemIdFromUrl();
                if (!problemId) {
                    showNotification('æœªæŒ‡å®šé¢˜ç›®ID', 'error');
                    goBack();
                    return;
                }

                console.log(`é¢˜ç›®è¯¦æƒ…é¡µé¢åˆå§‹åŒ–å¼€å§‹ï¼Œé¢˜ç›®ID: ${problemId}`);

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('problem-title').textContent = 'åŠ è½½ä¸­...';
                document.getElementById('problem-info').textContent = 'æ­£åœ¨è·å–é¢˜ç›®ä¿¡æ¯';

                // åˆå§‹åŒ–å­˜å‚¨å’Œç®¡ç†å™¨
                storage = new DataStorage();
                problemManager = new ProblemManager(storage);
                contestManager = new ContestManager(storage);

                // åˆå§‹åŒ–å…¨å±€æœç´¢
                try {
                    globalSearch = new GlobalSearchManager(storage);
                    console.log('å…¨å±€æœç´¢åˆå§‹åŒ–å®Œæˆ');
                } catch (error) {
                    console.error('åˆå§‹åŒ–å…¨å±€æœç´¢å¤±è´¥:', error);
                }

                // ç­‰å¾…åˆå§‹åŒ–å®Œæˆ - ä½¿ç”¨æ”¹è¿›çš„ç­‰å¾…æœºåˆ¶
                await Promise.all([
                    waitForManagerInitialization(problemManager),
                    waitForManagerInitialization(contestManager)
                ]);

                // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
                setupEventListeners();
                
                // åŠ è½½é¢˜ç›®æ•°æ® - ä½¿ç”¨å¤šç­–ç•¥åŒ¹é…
                await loadProblemData();
                
                console.log('é¢˜ç›®è¯¦æƒ…é¡µé¢åˆå§‹åŒ–å®Œæˆï¼Œé¢˜ç›®:', currentProblem?.title || 'æœªæ‰¾åˆ°');
            } catch (error) {
                console.error('é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
                showNotification('é¡µé¢åˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
                renderErrorState(error.message);
            }
        });

        // ç­‰å¾…ç®¡ç†å™¨åˆå§‹åŒ–çš„æ”¹è¿›æ–¹æ³•
        function waitForManagerInitialization(manager) {
            return new Promise((resolve, reject) => {
                if (manager.initialized) {
                    resolve();
                    return;
                }

                const timeout = setTimeout(() => {
                    reject(new Error('Manager initialization timeout'));
                }, 10000);

                const onInitialized = () => {
                    clearTimeout(timeout);
                    manager.off('initialized', onInitialized);
                    resolve();
                };

                manager.on('initialized', onInitialized);
            });
        }

        // å¤šç­–ç•¥é¢˜ç›®æŸ¥æ‰¾
        function findProblemById(problemId) {
            const problems = problemManager.problems || [];
            
            // Strategy 1: Direct ID match
            let problem = problems.find(p => p.id === problemId);
            
            if (!problem) {
                // Strategy 2: Contest-generated pattern match
                problem = problems.find(p => {
                    return p.contestId && p.problemLetter && 
                           `${p.contestId}-${p.problemLetter.toLowerCase()}` === problemId;
                });
            }
            
            if (!problem) {
                // Strategy 3: Partial ID match for legacy compatibility
                problem = problems.find(p => 
                    p.id.includes(problemId) || problemId.includes(p.id)
                );
            }
            
            if (!problem) {
                // Strategy 4: Title-based fallback
                problem = problems.find(p => 
                    p.title === problemId || p.title.includes(problemId)
                );
            }
            
            if (!problem) {
                console.warn(`Problem not found: ${problemId}`);
                console.log('Available problems:', problems.map(p => ({ 
                    id: p.id, 
                    title: p.title, 
                    contestId: p.contestId, 
                    problemLetter: p.problemLetter 
                })));
            }
            
            return problem;
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            problemManager.on('problemUpdated', () => {
                loadProblemData();
                showNotification('é¢˜ç›®æ›´æ–°æˆåŠŸ', 'success');
            });
        }

        // åŠ è½½é¢˜ç›®æ•°æ®
        async function loadProblemData() {
            try {
                // ä½¿ç”¨å¤šç­–ç•¥åŒ¹é…æŸ¥æ‰¾é¢˜ç›®
                currentProblem = findProblemById(problemId);
                if (!currentProblem) {
                    throw new Error(`Problem with ID '${problemId}' not found`);
                }

                updateProblemInfo();
            } catch (error) {
                console.error('åŠ è½½é¢˜ç›®æ•°æ®å¤±è´¥:', error);
                showNotification('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message, 'error');
                renderErrorState(error.message);
            }
        }

        // æ¸²æŸ“é”™è¯¯çŠ¶æ€
        function renderErrorState(message) {
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.innerHTML = `
                    <div class="page-header">
                        <div class="flex items-center gap-3">
                            <button class="btn btn-outline btn-sm" onclick="goBack()">â† è¿”å›é¢˜ç›®åˆ—è¡¨</button>
                            <div>
                                <h1 class="page-title">é¡µé¢åŠ è½½å¤±è´¥</h1>
                                <p class="page-subtitle">æ— æ³•åˆå§‹åŒ–é¢˜ç›®è¯¦æƒ…é¡µé¢</p>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="error-state text-center">
                                <h3>âš ï¸ é¢˜ç›®åŠ è½½å¤±è´¥</h3>
                                <p class="text-gray-600 mb-4">${escapeHtml(message)}</p>
                                <div class="btn-group">
                                    <button onclick="location.reload()" class="btn btn-primary">é‡æ–°åŠ è½½</button>
                                    <button onclick="goBack()" class="btn btn-outline">è¿”å›åˆ—è¡¨</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // æ›´æ–°é¢˜ç›®ä¿¡æ¯æ˜¾ç¤º
        async function updateProblemInfo() {
            document.getElementById('problem-title').textContent = currentProblem.title;
            document.getElementById('problem-info').textContent = 
                `${currentProblem.platform}${currentProblem.problemIndex ? ' â€¢ ' + currentProblem.problemIndex : ''}`;
            
            document.getElementById('problem-platform').textContent = currentProblem.platform;
            document.getElementById('problem-index').textContent = currentProblem.problemIndex || 'æ— ';
            
            // éš¾åº¦æ˜¾ç¤º
            if (currentProblem.difficulty) {
                document.getElementById('problem-difficulty').innerHTML = 
                    `<span class="difficulty-indicator difficulty-${Math.floor(currentProblem.difficulty/200)*200}">${currentProblem.difficulty}</span>`;
            } else {
                document.getElementById('problem-difficulty').textContent = 'æ— ';
            }

            // çŠ¶æ€æ˜¾ç¤º
            const statusDisplay = document.getElementById('problem-status-display');
            const statusToggleBtn = document.getElementById('status-toggle-btn');
            if (currentProblem.status === 'solved') {
                statusDisplay.innerHTML = '<span class="status-badge status-solved">âœ… å·²è§£å†³</span>';
                statusToggleBtn.innerHTML = 'âŒ æ ‡è®°ä¸ºæœªè§£å†³';
                statusToggleBtn.className = 'btn btn-sm btn-secondary';
            } else {
                statusDisplay.innerHTML = '<span class="status-badge status-todo">âŒ æœªè§£å†³</span>';
                statusToggleBtn.innerHTML = 'âœ… æ ‡è®°ä¸ºå·²è§£å†³';
                statusToggleBtn.className = 'btn btn-sm btn-success';
            }

            // é¢˜ç›®é“¾æ¥
            if (currentProblem.url) {
                document.getElementById('problem-url-link').href = currentProblem.url;
                document.getElementById('problem-url-link').style.display = 'inline';
                document.getElementById('problem-url-empty').style.display = 'none';
            } else {
                document.getElementById('problem-url-link').style.display = 'none';
                document.getElementById('problem-url-empty').style.display = 'inline';
            }

            // æ‰€å±æ¯”èµ›
            if (currentProblem.contestId) {
                const contest = contestManager.findContestById(currentProblem.contestId);
                if (contest) {
                    document.getElementById('problem-contest-link').href = `contest-detail.html?id=${currentProblem.contestId}`;
                    document.getElementById('problem-contest-link').textContent = contest.name;
                    document.getElementById('problem-contest-link').style.display = 'inline';
                    document.getElementById('problem-contest-empty').style.display = 'none';
                } else {
                    document.getElementById('problem-contest-link').style.display = 'none';
                    document.getElementById('problem-contest-empty').style.display = 'inline';
                }
            } else {
                document.getElementById('problem-contest-link').style.display = 'none';
                document.getElementById('problem-contest-empty').style.display = 'inline';
            }

            // åŠ è½½ç›¸å…³æ–‡ä»¶
            await loadProblemFiles();

            // æ ‡ç­¾
            if (currentProblem.tags && currentProblem.tags.length > 0) {
                document.getElementById('problem-tags-display').innerHTML = 
                    currentProblem.tags.map(tag => 
                        `<span class="tag tag-${getTagClass(tag)}">${escapeHtml(tag)}</span>`
                    ).join('');
                document.getElementById('problem-tags-section').style.display = 'block';
            } else {
                document.getElementById('problem-tags-section').style.display = 'none';
            }

            // å¤‡æ³¨
            if (currentProblem.notes) {
                document.getElementById('problem-notes-display').textContent = currentProblem.notes;
                document.getElementById('problem-notes-section').style.display = 'block';
            } else {
                document.getElementById('problem-notes-section').style.display = 'none';
            }

            // æ—¶é—´ä¿¡æ¯
            document.getElementById('problem-added-time').textContent = formatDateTime(currentProblem.addedTime);
            if (currentProblem.solvedTime) {
                document.getElementById('problem-solved-time').textContent = formatDateTime(currentProblem.solvedTime);
                document.getElementById('problem-solved-time-row').style.display = 'block';
            } else {
                document.getElementById('problem-solved-time-row').style.display = 'none';
            }
            document.getElementById('problem-times-section').style.display = 'block';

            // æ¸²æŸ“é¢˜è§£åˆ—è¡¨
            if (window.solutionManager) {
                window.solutionManager.renderSolutionsList(
                    currentProblem.solutions || [], 
                    'solutions-container', 
                    currentProblem.id, 
                    false
                );
            }
        }

        // åŠ è½½é¢˜ç›®ç›¸å…³æ–‡ä»¶
        async function loadProblemFiles() {
            try {
                if (!window.fileManager) {
                    document.getElementById('problem-files-container').innerHTML = '<span class="text-gray-500">æ–‡ä»¶ç®¡ç†å™¨æœªåˆå§‹åŒ–</span>';
                    document.getElementById('solution-files-container').innerHTML = '<span class="text-gray-500">æ–‡ä»¶ç®¡ç†å™¨æœªåˆå§‹åŒ–</span>';
                    return;
                }

                // ç¡®å®šæ¯”èµ›IDå’Œé¢˜ç›®å­—æ¯
                let contestId = currentProblem.contestId;
                let problemLetter = currentProblem.problemLetter;

                // å¦‚æœæ²¡æœ‰æ¯”èµ›IDï¼Œå°è¯•ä»é¢˜ç›®IDä¸­æ¨æ–­
                if (!contestId && currentProblem.id) {
                    const match = currentProblem.id.match(/^([^-]+)-([a-zA-Z])$/);
                    if (match) {
                        contestId = match[1];
                        problemLetter = match[2].toUpperCase();
                    }
                }

                if (contestId && problemLetter) {
                    // æ¸²æŸ“é¢˜ç›®ç›¸å…³æ–‡ä»¶
                    const problemFilesHtml = await window.fileManager.renderProblemFiles(contestId, problemLetter);
                    if (problemFilesHtml) {
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = problemFilesHtml;
                        
                        // æå–é¢˜é¢æ–‡ä»¶
                        const problemSection = tempDiv.querySelector('.file-section h4');
                        if (problemSection && problemSection.textContent === 'é¢˜é¢') {
                            const problemFiles = problemSection.nextElementSibling;
                            document.getElementById('problem-files-container').innerHTML = problemFiles ? problemFiles.outerHTML : '<span class="text-gray-500">æš‚æ— é¢˜é¢æ–‡ä»¶</span>';
                        } else {
                            document.getElementById('problem-files-container').innerHTML = '<span class="text-gray-500">æš‚æ— é¢˜é¢æ–‡ä»¶</span>';
                        }
                        
                        // æå–é¢˜è§£æ–‡ä»¶
                        const solutionSection = Array.from(tempDiv.querySelectorAll('.file-section h4')).find(h => h.textContent === 'é¢˜è§£');
                        if (solutionSection && solutionSection.nextElementSibling) {
                            document.getElementById('solution-files-container').innerHTML = solutionSection.nextElementSibling.innerHTML;
                        } else {
                            document.getElementById('solution-files-container').innerHTML = '<span class="text-gray-500">æš‚æ— é¢˜è§£æ–‡ä»¶</span>';
                        }
                    } else {
                        document.getElementById('problem-files-container').innerHTML = '<span class="text-gray-500">æš‚æ— é¢˜é¢æ–‡ä»¶</span>';
                        document.getElementById('solution-files-container').innerHTML = '<span class="text-gray-500">æš‚æ— é¢˜è§£æ–‡ä»¶</span>';
                    }
                } else {
                    // å…¼å®¹åŸæœ‰çš„PDFå’Œé¢˜è§£è·¯å¾„æ˜¾ç¤º
                    let problemFilesHtml = '';
                    let solutionFilesHtml = '';
                    
                    if (currentProblem.pdfPath) {
                        problemFilesHtml = `<a href="${currentProblem.pdfPath}" target="_blank" class="file-link">ğŸ“„ é¢˜ç›®PDF</a>`;
                    }
                    
                    if (currentProblem.solutionPath) {
                        const ext = currentProblem.solutionPath.split('.').pop().toLowerCase();
                        const icon = ext === 'pdf' ? 'ğŸ“„' : 'ğŸ“';
                        const fileName = currentProblem.solutionPath.split('/').pop();
                        
                        if (ext === 'md') {
                            const viewerUrl = `file-viewer.html?file=${encodeURIComponent(currentProblem.solutionPath)}&name=${encodeURIComponent(fileName)}`;
                            solutionFilesHtml = `<a href="${viewerUrl}" target="_blank" class="file-link">${icon} ${fileName}</a>`;
                        } else {
                            solutionFilesHtml = `<a href="${currentProblem.solutionPath}" target="_blank" class="file-link">${icon} ${fileName}</a>`;
                        }
                    }
                    
                    document.getElementById('problem-files-container').innerHTML = problemFilesHtml || '<span class="text-gray-500">æš‚æ— é¢˜é¢æ–‡ä»¶</span>';
                    document.getElementById('solution-files-container').innerHTML = solutionFilesHtml || '<span class="text-gray-500">æš‚æ— é¢˜è§£æ–‡ä»¶</span>';
                }
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶å¤±è´¥:', error);
                document.getElementById('problem-files-container').innerHTML = '<span class="text-red-500">æ–‡ä»¶åŠ è½½å¤±è´¥</span>';
                document.getElementById('solution-files-container').innerHTML = '<span class="text-red-500">æ–‡ä»¶åŠ è½½å¤±è´¥</span>';
            }
        }

        // åˆ‡æ¢é¢˜ç›®çŠ¶æ€
        function toggleStatus() {
            try {
                const newStatus = currentProblem.status === 'solved' ? 'unsolved' : 'solved';
                problemManager.updateProblem(problemId, { status: newStatus });
            } catch (error) {
                showNotification('æ›´æ–°çŠ¶æ€å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ç¼–è¾‘é¢˜ç›®
        function editProblem() {
            window.location.href = `problems.html?edit=${problemId}`;
        }

        // ç”Ÿæˆé¢˜è§£æ¨¡æ¿
        function createSolutionTemplate() {
            try {
                const template = `# ${currentProblem.title} é¢˜è§£

## é¢˜ç›®ä¿¡æ¯
- **å¹³å°**: ${currentProblem.platform}
- **é¢˜ç›®ç¼–å·**: ${currentProblem.problemIndex || 'æ— '}
- **éš¾åº¦**: ${currentProblem.difficulty || 'æ— '}
- **é¢˜ç›®é“¾æ¥**: ${currentProblem.url || 'æ— '}
- **çŠ¶æ€**: ${currentProblem.status === 'solved' ? 'âœ… å·²è§£å†³' : 'âŒ æœªè§£å†³'}

## é¢˜ç›®æè¿°
[åœ¨æ­¤æ·»åŠ é¢˜ç›®æè¿°æˆ–å…³é”®ä¿¡æ¯]

## è§£é¢˜æ€è·¯
[åœ¨æ­¤æè¿°è§£é¢˜æ€è·¯å’Œæ–¹æ³•]

## ç®—æ³•/æ•°æ®ç»“æ„
[ä½¿ç”¨çš„ç®—æ³•æˆ–æ•°æ®ç»“æ„]

## ä»£ç å®ç°
\`\`\`cpp
// åœ¨æ­¤æ·»åŠ ä»£ç 
\`\`\`

## å¤æ‚åº¦åˆ†æ
- **æ—¶é—´å¤æ‚åº¦**: O(?)
- **ç©ºé—´å¤æ‚åº¦**: O(?)

## æ€»ç»“
[è§£é¢˜æ€»ç»“å’Œæ”¶è·]

## ç›¸å…³é¢˜ç›®
[ç±»ä¼¼é¢˜ç›®æˆ–æ‰©å±•é¢˜ç›®]

---
*é¢˜è§£åˆ›å»ºæ—¶é—´: ${new Date().toLocaleString('zh-CN')}*
`;

                const blob = new Blob([template], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentProblem.title}-é¢˜è§£.md`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('é¢˜è§£æ¨¡æ¿ä¸‹è½½æˆåŠŸ', 'success');
            } catch (error) {
                showNotification('ç”Ÿæˆé¢˜è§£æ¨¡æ¿å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¤åˆ¶é¢˜ç›®ä¿¡æ¯
        function copyProblemInfo() {
            try {
                const info = `${currentProblem.title}
å¹³å°: ${currentProblem.platform}
ç¼–å·: ${currentProblem.problemIndex || 'æ— '}
éš¾åº¦: ${currentProblem.difficulty || 'æ— '}
çŠ¶æ€: ${currentProblem.status === 'solved' ? 'âœ… å·²è§£å†³' : 'âŒ æœªè§£å†³'}
é“¾æ¥: ${currentProblem.url || 'æ— '}`;

                navigator.clipboard.writeText(info).then(() => {
                    showNotification('é¢˜ç›®ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(() => {
                    // é™çº§æ–¹æ¡ˆ
                    const textArea = document.createElement('textarea');
                    textArea.value = info;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showNotification('é¢˜ç›®ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                });
            } catch (error) {
                showNotification('å¤åˆ¶å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ·»åŠ åˆ°è‡ªå®šä¹‰æ¯”èµ›
        function addToCustomContest() {
            // è¿™é‡Œå¯ä»¥å®ç°æ·»åŠ åˆ°è‡ªå®šä¹‰æ¯”èµ›çš„åŠŸèƒ½
            showNotification('æ­¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­', 'info');
        }

        // æ‰“å¼€é¢˜è§£ç®¡ç†å™¨
        function openSolutionManager() {
            if (!currentProblem) {
                showNotification('é¢˜ç›®ä¿¡æ¯æœªåŠ è½½', 'error');
                return;
            }
            
            // ä¿å­˜å½“å‰é¢˜ç›®IDåˆ°localStorage
            localStorage.setItem('current-problem-id', currentProblem.id);
            
            // åœ¨æ–°çª—å£ä¸­æ‰“å¼€é¢˜è§£ç®¡ç†å™¨
            const managerWindow = window.open(
                `solution-manager.html?problemId=${encodeURIComponent(currentProblem.id)}`,
                'solution-manager',
                'width=1000,height=800,scrollbars=yes,resizable=yes'
            );
            
            if (!managerWindow) {
                showNotification('æ— æ³•æ‰“å¼€é¢˜è§£ç®¡ç†å™¨çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨çš„å¼¹çª—è®¾ç½®', 'error');
            } else {
                showNotification('é¢˜è§£ç®¡ç†å™¨å·²æ‰“å¼€', 'success');
            }
        }

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            window.location.href = 'problems.html';
        }

        // å·¥å…·å‡½æ•°
        function formatDateTime(dateString) {
            try {
                return new Date(dateString).toLocaleString('zh-CN');
            } catch {
                return dateString;
            }
        }

        function getTagClass(tag) {
            const tagClasses = {
                'dp': 'dp',
                'greedy': 'greedy', 
                'graph': 'graph',
                'math': 'math',
                'string': 'string'
            };
            return tagClasses[tag] || 'default';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showNotification(message, type = 'info') {
            if (storage && storage.showNotification) {
                storage.showNotification(message, type);
            } else {
                alert(message);
            }
        }
    </script>
    
    <style>
        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .gap-3 {
            gap: 0.75rem;
        }

        .form-value {
            padding: 0.5rem 0;
            color: #374151;
            font-weight: 500;
        }

        .form-value a {
            color: #3b82f6;
            text-decoration: none;
        }

        .form-value a:hover {
            text-decoration: underline;
        }

        .time-info div {
            margin-bottom: 0.25rem;
        }

        .time-info div:last-child {
            margin-bottom: 0;
        }

        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-solved {
            background: #d1fae5;
            color: #065f46;
        }

        .status-todo {
            background: #fee2e2;
            color: #991b1b;
        }

        .difficulty-indicator {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
        }

        .difficulty-800 { background: #22c55e; }
        .difficulty-1000 { background: #84cc16; }
        .difficulty-1200 { background: #eab308; }
        .difficulty-1400 { background: #f97316; }
        .difficulty-1600 { background: #ef4444; }
        .difficulty-1800 { background: #dc2626; }
        .difficulty-2000 { background: #b91c1c; }
        .difficulty-2200 { background: #7c2d12; }
        .difficulty-2400 { background: #374151; }
        .difficulty-2600 { background: #1f2937; }
        .difficulty-2800 { background: #111827; }
        .difficulty-3000 { background: #000000; }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            padding: 0.25rem 0.5rem;
            background: #f3f4f6;
            border-radius: 4px;
            font-size: 0.75rem;
            color: #374151;
        }

        .tag-dp { background: #dbeafe; color: #1d4ed8; }
        .tag-greedy { background: #dcfce7; color: #166534; }
        .tag-graph { background: #f3e8ff; color: #7c3aed; }
        .tag-math { background: #fef3c7; color: #d97706; }
        .tag-string { background: #fce7f3; color: #be185d; }

        /* æ–‡ä»¶é“¾æ¥æ ·å¼ */
        .file-link {
            display: inline-block;
            margin-right: 0.5rem;
            margin-bottom: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            text-decoration: none;
            color: #374151;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .file-link:hover {
            background: #e2e8f0;
            border-color: #cbd5e1;
            text-decoration: none;
        }

        .file-link-pdf {
            border-left: 3px solid #dc2626;
        }

        .file-link-md {
            border-left: 3px solid #059669;
        }

        .file-section {
            margin-bottom: 1rem;
        }

        .file-section h4 {
            display: none; /* éšè—sectionæ ‡é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨form-labelä¸­å·²ç»æœ‰äº† */
        }

        .text-gray-500 {
            color: #6b7280;
        }

        .text-red-500 {
            color: #ef4444;
        }
    </style>
</body>
</html>