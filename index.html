<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»ªè¡¨æ¿ - ACMä¸­è½¬ç«™</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="navbar-brand">ACMä¸­è½¬ç«™</a>
            <ul class="navbar-nav">
                <li><a href="index.html" class="active">ä»ªè¡¨æ¿</a></li>
                <li><a href="contests.html">æ¯”èµ›ç®¡ç†</a></li>
                <li><a href="problems.html">é¢˜ç›®ç®¡ç†</a></li>
            </ul>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="page-title">æ¬¢è¿ä½¿ç”¨ACMä¸­è½¬ç«™</h1>
            <p class="page-subtitle">ä¸€ç«™å¼ç®¡ç†ä½ çš„ç«èµ›è®°å½•å’Œé¢˜ç›®è¿›åº¦</p>
        </div>

        <!-- å¿«é€Ÿæ“ä½œæŒ‰é’® -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">å¿«é€Ÿæ“ä½œ</h2>
                <div class="card-actions">
                    <button class="btn btn-outline btn-sm" onclick="showAppInfo()">ç³»ç»Ÿä¿¡æ¯</button>
                    <button class="btn btn-secondary btn-sm" onclick="syncAllData()">åŒæ­¥æ•°æ®</button>
                </div>
            </div>
            <div class="btn-group">
                <a href="contests.html" class="btn btn-primary">æ·»åŠ æ¯”èµ›è®°å½•</a>
                <a href="problems.html" class="btn btn-success">æ·»åŠ é¢˜ç›®è®°å½•</a>
                <button class="btn btn-outline" onclick="exportAllData()">å¯¼å‡ºæ‰€æœ‰æ•°æ®</button>
                <button class="btn btn-outline" onclick="importAllData()">å¯¼å…¥æ•°æ®</button>
            </div>
        </div>

        <!-- æ€»ä½“ç»Ÿè®¡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-contests">0</div>
                <div class="stat-label">æ€»æ¯”èµ›æ•°</div>
                <div class="stat-change" id="contests-change">æ–°å¢ 0 åœº</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-problems">0</div>
                <div class="stat-label">æ€»é¢˜ç›®æ•°</div>
                <div class="stat-change" id="problems-change">æ–°å¢ 0 é“</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="solved-problems">0</div>
                <div class="stat-label">å·²è§£å†³é¢˜ç›®</div>
                <div class="stat-change" id="solve-rate">è§£å†³ç‡ 0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="average-rank">-</div>
                <div class="stat-label">å¹³å‡æ’å</div>
                <div class="stat-change" id="rank-trend">-</div>
            </div>
        </div>

        <!-- æ´»åŠ¨æ¦‚è§ˆ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="this-month-contests">0</div>
                <div class="stat-label">æœ¬æœˆæ¯”èµ›</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="this-week-solved">0</div>
                <div class="stat-label">æœ¬å‘¨è§£é¢˜</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="average-difficulty">-</div>
                <div class="stat-label">å¹³å‡éš¾åº¦</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="active-days">0</div>
                <div class="stat-label">æ´»è·ƒå¤©æ•°</div>
            </div>
        </div>

        <!-- æœ€è¿‘æ´»åŠ¨ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">æœ€è¿‘æ´»åŠ¨</h2>
                <div class="card-actions">
                    <button class="btn btn-outline btn-sm" onclick="refreshData()">åˆ·æ–°</button>
                </div>
            </div>
            
            <!-- æœ€è¿‘æ¯”èµ› -->
            <div class="mb-4">
                <h3 class="text-lg font-weight-600 mb-2">æœ€è¿‘æ¯”èµ›</h3>
                <div id="recent-contests">
                    <div class="text-center text-gray-500 p-4">
                        <p>æš‚æ— æ¯”èµ›è®°å½•</p>
                        <a href="contests.html" class="btn btn-primary btn-sm mt-2">æ·»åŠ ç¬¬ä¸€åœºæ¯”èµ›</a>
                    </div>
                </div>
            </div>

            <!-- æœ€è¿‘é¢˜ç›® -->
            <div class="mb-4">
                <h3 class="text-lg font-weight-600 mb-2">æœ€è¿‘è§£å†³çš„é¢˜ç›®</h3>
                <div id="recent-problems">
                    <div class="text-center text-gray-500 p-4">
                        <p>æš‚æ— é¢˜ç›®è®°å½•</p>
                        <a href="problems.html" class="btn btn-success btn-sm mt-2">æ·»åŠ ç¬¬ä¸€é“é¢˜ç›®</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¹³å°åˆ†å¸ƒ -->
        <div class="stats-grid">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">æ¯”èµ›å¹³å°åˆ†å¸ƒ</h3>
                </div>
                <div id="contest-platforms">
                    <div class="text-center text-gray-500 p-4">æš‚æ— æ•°æ®</div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">é¢˜ç›®æ ‡ç­¾åˆ†å¸ƒ</h3>
                </div>
                <div id="problem-tags">
                    <div class="text-center text-gray-500 p-4">æš‚æ— æ•°æ®</div>
                </div>
            </div>
        </div>

        <!-- è¿›åº¦å›¾è¡¨ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">æœˆåº¦è¿›åº¦</h2>
            </div>
            <div class="p-4">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-500" id="current-month-contests">0</div>
                        <div class="text-sm text-gray-500">æœ¬æœˆæ¯”èµ›</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-500" id="current-month-problems">0</div>
                        <div class="text-sm text-gray-500">æœ¬æœˆè§£é¢˜</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-500" id="streak-days">0</div>
                        <div class="text-sm text-gray-500">è¿ç»­å¤©æ•°</div>
                    </div>
                </div>
                <div id="monthly-chart" class="text-center text-gray-500">
                    <p>å›¾è¡¨åŠŸèƒ½å¾…å®ç°</p>
                </div>
            </div>
        </div>

        <!-- æ¨èå’Œç›®æ ‡ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">æ¨èä¸ç›®æ ‡</h2>
            </div>
            <div class="p-4">
                <div id="recommendations">
                    <!-- åŠ¨æ€ç”Ÿæˆæ¨èå†…å®¹ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ç³»ç»Ÿä¿¡æ¯æ¨¡æ€æ¡† -->
    <div id="app-info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç³»ç»Ÿä¿¡æ¯</h3>
                <button class="modal-close" onclick="closeAppInfoModal()">&times;</button>
            </div>
            <div class="modal-body" id="app-info-content">
                <!-- åŠ¨æ€å¡«å……ç³»ç»Ÿä¿¡æ¯ -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeAppInfoModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- åŠ è½½JavaScript -->
    <script src="js/storage.js"></script>
    <script src="js/contests.js"></script>
    <script src="js/problems.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        // ä»ªè¡¨æ¿ä¸“ç”¨åŠŸèƒ½
        let dashboardData = {
            contests: [],
            problems: [],
            lastUpdate: null
        };

        // ç­‰å¾…åº”ç”¨ç¨‹åºåˆå§‹åŒ–å®Œæˆ
        document.addEventListener('acm-appInitialized', function(event) {
            console.log('ä»ªè¡¨æ¿ï¼šåº”ç”¨ç¨‹åºåˆå§‹åŒ–å®Œæˆ');
            loadDashboardData();
        });

        // å¦‚æœåº”ç”¨å·²ç»åˆå§‹åŒ–ï¼Œç›´æ¥åŠ è½½æ•°æ®
        setTimeout(() => {
            if (window.ACMTransit && window.ACMTransit.initialized) {
                loadDashboardData();
            }
        }, 1000);

        // åŠ è½½ä»ªè¡¨æ¿æ•°æ®
        async function loadDashboardData() {
            try {
                const app = window.ACMTransit;
                if (!app || !app.initialized) {
                    console.log('ç­‰å¾…åº”ç”¨ç¨‹åºåˆå§‹åŒ–...');
                    return;
                }

                // è·å–ç»Ÿè®¡æ•°æ®
                const stats = app.getStatistics();
                
                // è·å–è¯¦ç»†æ•°æ®
                if (app.contestManager) {
                    dashboardData.contests = app.contestManager.getAllContests();
                }
                if (app.problemManager) {
                    dashboardData.problems = app.problemManager.getAllProblems();
                }

                dashboardData.lastUpdate = new Date().toISOString();

                // æ›´æ–°UI
                updateStatistics(stats);
                updateRecentActivities();
                updatePlatformDistribution();
                updateRecommendations();

            } catch (error) {
                console.error('åŠ è½½ä»ªè¡¨æ¿æ•°æ®å¤±è´¥:', error);
                showNotification('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics(stats) {
            // åŸºç¡€ç»Ÿè®¡
            document.getElementById('total-contests').textContent = stats.contests.total;
            document.getElementById('total-problems').textContent = stats.problems.total;
            document.getElementById('solved-problems').textContent = stats.problems.solved;

            // è®¡ç®—è§£å†³ç‡
            const solveRate = stats.problems.total > 0 ? 
                Math.round((stats.problems.solved / stats.problems.total) * 100) : 0;
            document.getElementById('solve-rate').textContent = `è§£å†³ç‡ ${solveRate}%`;

            // æœ¬æœˆæ´»åŠ¨
            const thisMonth = new Date().toISOString().substring(0, 7);
            const thisMonthContests = dashboardData.contests.filter(c => 
                c.date.substring(0, 7) === thisMonth
            ).length;
            document.getElementById('this-month-contests').textContent = thisMonthContests;
            document.getElementById('current-month-contests').textContent = thisMonthContests;

            // æœ¬å‘¨è§£é¢˜
            const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const thisWeekSolved = dashboardData.problems.filter(p => 
                p.status === 'solved' && 
                p.solvedTime && 
                new Date(p.solvedTime) >= oneWeekAgo
            ).length;
            document.getElementById('this-week-solved').textContent = thisWeekSolved;

            // å¹³å‡éš¾åº¦
            const solvedWithDifficulty = dashboardData.problems.filter(p => 
                p.status === 'solved' && p.difficulty
            );
            if (solvedWithDifficulty.length > 0) {
                const avgDiff = Math.round(
                    solvedWithDifficulty.reduce((sum, p) => sum + p.difficulty, 0) / 
                    solvedWithDifficulty.length
                );
                document.getElementById('average-difficulty').textContent = avgDiff;
            }

            // å¹³å‡æ’åï¼ˆæ¥è‡ªæ¯”èµ›ç®¡ç†å™¨ï¼‰
            if (window.ACMTransit && window.ACMTransit.contestManager) {
                const contestStats = window.ACMTransit.contestManager.getStatistics();
                document.getElementById('average-rank').textContent = contestStats.averageRank || '-';
            }

            // å½“æœˆè§£é¢˜æ•°
            const thisMonthProblems = dashboardData.problems.filter(p => 
                p.status === 'solved' && 
                p.solvedTime && 
                p.solvedTime.substring(0, 7) === thisMonth
            ).length;
            document.getElementById('current-month-problems').textContent = thisMonthProblems;

            // è®¡ç®—æ´»è·ƒå¤©æ•°
            const activeDays = calculateActiveDays();
            document.getElementById('active-days').textContent = activeDays;
        }

        // æ›´æ–°æœ€è¿‘æ´»åŠ¨
        function updateRecentActivities() {
            // æœ€è¿‘æ¯”èµ›
            const recentContests = dashboardData.contests
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            const contestsContainer = document.getElementById('recent-contests');
            if (recentContests.length === 0) {
                contestsContainer.innerHTML = `
                    <div class="text-center text-gray-500 p-4">
                        <p>æš‚æ— æ¯”èµ›è®°å½•</p>
                        <a href="contests.html" class="btn btn-primary btn-sm mt-2">æ·»åŠ ç¬¬ä¸€åœºæ¯”èµ›</a>
                    </div>
                `;
            } else {
                contestsContainer.innerHTML = recentContests.map(contest => `
                    <div class="flex justify-between items-center p-3 border-b border-gray-200">
                        <div>
                            <div class="font-weight-500">${escapeHtml(contest.name)}</div>
                            <div class="text-sm text-gray-500">${contest.platform} â€¢ ${formatDate(contest.date)}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm">${contest.rank || '-'}</div>
                            <div class="text-sm text-gray-500">${contest.solved || 0}é¢˜</div>
                        </div>
                    </div>
                `).join('');
            }

            // æœ€è¿‘è§£å†³çš„é¢˜ç›®
            const recentProblems = dashboardData.problems
                .filter(p => p.status === 'solved' && p.solvedTime)
                .sort((a, b) => new Date(b.solvedTime) - new Date(a.solvedTime))
                .slice(0, 5);

            const problemsContainer = document.getElementById('recent-problems');
            if (recentProblems.length === 0) {
                problemsContainer.innerHTML = `
                    <div class="text-center text-gray-500 p-4">
                        <p>æš‚æ— å·²è§£å†³çš„é¢˜ç›®</p>
                        <a href="problems.html" class="btn btn-success btn-sm mt-2">å¼€å§‹åˆ·é¢˜</a>
                    </div>
                `;
            } else {
                problemsContainer.innerHTML = recentProblems.map(problem => `
                    <div class="flex justify-between items-center p-3 border-b border-gray-200">
                        <div>
                            <div class="font-weight-500">${escapeHtml(problem.title)}</div>
                            <div class="text-sm text-gray-500">
                                ${problem.platform} â€¢ 
                                ${problem.difficulty ? `éš¾åº¦ ${problem.difficulty}` : 'æœªçŸ¥éš¾åº¦'}
                            </div>
                        </div>
                        <div class="tags-container">
                            ${(problem.tags || []).slice(0, 2).map(tag => 
                                `<span class="tag tag-${getTagClass(tag)}">${tag}</span>`
                            ).join('')}
                        </div>
                    </div>
                `).join('');
            }
        }

        // æ›´æ–°å¹³å°åˆ†å¸ƒ
        function updatePlatformDistribution() {
            // æ¯”èµ›å¹³å°åˆ†å¸ƒ
            const contestPlatforms = {};
            dashboardData.contests.forEach(contest => {
                contestPlatforms[contest.platform] = (contestPlatforms[contest.platform] || 0) + 1;
            });

            const contestPlatformsContainer = document.getElementById('contest-platforms');
            if (Object.keys(contestPlatforms).length === 0) {
                contestPlatformsContainer.innerHTML = '<div class="text-center text-gray-500 p-4">æš‚æ— æ•°æ®</div>';
            } else {
                const sortedPlatforms = Object.entries(contestPlatforms)
                    .sort(([,a], [,b]) => b - a);
                
                contestPlatformsContainer.innerHTML = sortedPlatforms.map(([platform, count]) => `
                    <div class="flex justify-between items-center p-2 border-b border-gray-200">
                        <span class="tag">${platform}</span>
                        <span class="font-weight-500">${count}</span>
                    </div>
                `).join('');
            }

            // é¢˜ç›®æ ‡ç­¾åˆ†å¸ƒ
            const tagCounts = {};
            dashboardData.problems.forEach(problem => {
                (problem.tags || []).forEach(tag => {
                    tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                });
            });

            const problemTagsContainer = document.getElementById('problem-tags');
            if (Object.keys(tagCounts).length === 0) {
                problemTagsContainer.innerHTML = '<div class="text-center text-gray-500 p-4">æš‚æ— æ•°æ®</div>';
            } else {
                const sortedTags = Object.entries(tagCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 8);
                
                problemTagsContainer.innerHTML = sortedTags.map(([tag, count]) => `
                    <div class="flex justify-between items-center p-2 border-b border-gray-200">
                        <span class="tag tag-${getTagClass(tag)}">${tag}</span>
                        <span class="font-weight-500">${count}</span>
                    </div>
                `).join('');
            }
        }

        // æ›´æ–°æ¨è
        function updateRecommendations() {
            const recommendations = [];
            
            // åŸºäºæ•°æ®ç”Ÿæˆæ¨è
            const totalContests = dashboardData.contests.length;
            const totalProblems = dashboardData.problems.length;
            const solvedProblems = dashboardData.problems.filter(p => p.status === 'solved').length;

            if (totalContests === 0) {
                recommendations.push({
                    type: 'action',
                    title: 'è®°å½•ç¬¬ä¸€åœºæ¯”èµ›',
                    desc: 'å¼€å§‹è®°å½•ä½ çš„æ¯”èµ›å†ç¨‹ï¼Œè·Ÿè¸ªè¿›æ­¥è¿‡ç¨‹',
                    action: 'contests.html',
                    actionText: 'æ·»åŠ æ¯”èµ›'
                });
            }

            if (totalProblems === 0) {
                recommendations.push({
                    type: 'action', 
                    title: 'å¼€å§‹åˆ·é¢˜ä¹‹æ—…',
                    desc: 'è®°å½•ä½ çš„æ¯ä¸€é“é¢˜ç›®ï¼Œå»ºç«‹ä¸ªäººé¢˜åº“',
                    action: 'problems.html',
                    actionText: 'æ·»åŠ é¢˜ç›®'
                });
            }

            if (totalProblems > 0 && solvedProblems < totalProblems * 0.5) {
                recommendations.push({
                    type: 'goal',
                    title: 'æé«˜è§£é¢˜ç‡',
                    desc: `å½“å‰è§£é¢˜ç‡ ${Math.round(solvedProblems/totalProblems*100)}%ï¼Œå»ºè®®å¤šç»ƒä¹ åŸºç¡€é¢˜ç›®`,
                    action: 'problems.html',
                    actionText: 'æŸ¥çœ‹é¢˜ç›®'
                });
            }

            if (totalContests >= 5 && !hasRecentActivity()) {
                recommendations.push({
                    type: 'reminder',
                    title: 'ä¿æŒç»ƒä¹ èŠ‚å¥',
                    desc: 'æœ€è¿‘æ²¡æœ‰æ–°çš„æ´»åŠ¨è®°å½•ï¼Œå»ºè®®ä¿æŒå®šæœŸç»ƒä¹ ',
                    action: 'contests.html',
                    actionText: 'æŸ¥çœ‹æ¯”èµ›'
                });
            }

            const container = document.getElementById('recommendations');
            if (recommendations.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500">
                        <p>å¤ªæ£’äº†ï¼ç»§ç»­ä¿æŒå­¦ä¹ å’Œç»ƒä¹ çš„èŠ‚å¥</p>
                        <p class="text-sm mt-2">å»ºè®®å®šæœŸå‚åŠ æ¯”èµ›å¹¶è®°å½•é¢˜ç›®ç»ƒä¹ æƒ…å†µ</p>
                    </div>
                `;
            } else {
                container.innerHTML = recommendations.map(rec => `
                    <div class="p-3 border border-gray-200 rounded mb-3">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-weight-600 mb-1">${rec.title}</h4>
                                <p class="text-gray-600 text-sm">${rec.desc}</p>
                            </div>
                            <a href="${rec.action}" class="btn btn-sm btn-outline">${rec.actionText}</a>
                        </div>
                    </div>
                `).join('');
            }
        }

        // è®¡ç®—æ´»è·ƒå¤©æ•°
        function calculateActiveDays() {
            const dates = new Set();
            
            // æ·»åŠ æ¯”èµ›æ—¥æœŸ
            dashboardData.contests.forEach(contest => {
                dates.add(contest.date.split('T')[0]);
            });
            
            // æ·»åŠ è§£é¢˜æ—¥æœŸ
            dashboardData.problems.forEach(problem => {
                if (problem.solvedTime) {
                    dates.add(problem.solvedTime.split('T')[0]);
                }
                if (problem.addedTime) {
                    dates.add(problem.addedTime.split('T')[0]);
                }
            });
            
            return dates.size;
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰æœ€è¿‘æ´»åŠ¨
        function hasRecentActivity() {
            const twoWeeksAgo = new Date(Date.now() - 14 * 24 * 60 * 60 * 1000);
            
            // æ£€æŸ¥æœ€è¿‘çš„æ¯”èµ›
            const recentContests = dashboardData.contests.some(contest => 
                new Date(contest.date) >= twoWeeksAgo
            );
            
            // æ£€æŸ¥æœ€è¿‘è§£å†³çš„é¢˜ç›®
            const recentProblems = dashboardData.problems.some(problem => 
                problem.solvedTime && new Date(problem.solvedTime) >= twoWeeksAgo
            );
            
            return recentContests || recentProblems;
        }

        // æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
        function showAppInfo() {
            const app = window.ACMTransit;
            if (!app) {
                alert('åº”ç”¨ç¨‹åºæœªåˆå§‹åŒ–');
                return;
            }

            const info = app.getAppInfo();
            const content = document.getElementById('app-info-content');
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h4 class="font-weight-600">åº”ç”¨ä¿¡æ¯</h4>
                        <p>åç§°: ${info.name}</p>
                        <p>ç‰ˆæœ¬: ${info.version}</p>
                        <p>å½“å‰é¡µé¢: ${info.currentPage}</p>
                        <p>åˆå§‹åŒ–çŠ¶æ€: ${info.initialized ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}</p>
                    </div>
                    <div>
                        <h4 class="font-weight-600">åŠŸèƒ½æ”¯æŒ</h4>
                        <p>æœ¬åœ°å­˜å‚¨: ${info.features.localStorage ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</p>
                        <p>æ–‡ä»¶ç³»ç»Ÿè®¿é—®: ${info.features.fileSystemAccess ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</p>
                        <p>ç½‘ç»œçŠ¶æ€: ${info.features.offline ? 'ğŸ”´ ç¦»çº¿' : 'ğŸŸ¢ åœ¨çº¿'}</p>
                    </div>
                    <div>
                        <h4 class="font-weight-600">ç®¡ç†å™¨çŠ¶æ€</h4>
                        <p>å­˜å‚¨ç®¡ç†å™¨: ${info.managers.storage ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}</p>
                        <p>æ¯”èµ›ç®¡ç†å™¨: ${info.managers.contests ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}</p>
                        <p>é¢˜ç›®ç®¡ç†å™¨: ${info.managers.problems ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}</p>
                    </div>
                    <div>
                        <h4 class="font-weight-600">æ•°æ®ç»Ÿè®¡</h4>
                        <p>æ¯”èµ›è®°å½•: ${dashboardData.contests.length} æ¡</p>
                        <p>é¢˜ç›®è®°å½•: ${dashboardData.problems.length} æ¡</p>
                        <p>ä¸Šæ¬¡æ›´æ–°: ${dashboardData.lastUpdate ? new Date(dashboardData.lastUpdate).toLocaleString('zh-CN') : 'æœªçŸ¥'}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('app-info-modal').classList.add('show');
        }

        // å…³é—­ç³»ç»Ÿä¿¡æ¯æ¨¡æ€æ¡†
        function closeAppInfoModal() {
            document.getElementById('app-info-modal').classList.remove('show');
        }

        // åŒæ­¥æ‰€æœ‰æ•°æ®
        async function syncAllData() {
            const app = window.ACMTransit;
            if (app && app.syncData) {
                await app.syncData();
                loadDashboardData();
            }
        }

        // å¯¼å‡ºæ‰€æœ‰æ•°æ®
        async function exportAllData() {
            try {
                const app = window.ACMTransit;
                if (!app || !app.storage) {
                    throw new Error('å­˜å‚¨ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }

                const allData = {
                    contests: dashboardData.contests,
                    problems: dashboardData.problems,
                    exportTime: new Date().toISOString(),
                    version: '1.0'
                };

                const success = await app.storage.exportData(allData, `acm-transit-backup-${formatDateString()}.json`);
                if (success) {
                    showNotification('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
                }
            } catch (error) {
                showNotification('å¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¯¼å…¥æ•°æ®
        async function importAllData() {
            try {
                const app = window.ACMTransit;
                if (!app || !app.storage) {
                    throw new Error('å­˜å‚¨ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }

                const data = await app.storage.importData();
                if (data) {
                    // è¿™é‡Œå¯ä»¥è¿›ä¸€æ­¥å¤„ç†å¯¼å…¥çš„æ•°æ®
                    showNotification('æ•°æ®å¯¼å…¥æˆåŠŸ', 'success');
                    loadDashboardData();
                }
            } catch (error) {
                showNotification('å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            loadDashboardData();
            showNotification('æ•°æ®å·²åˆ·æ–°', 'success');
        }

        // å·¥å…·å‡½æ•°
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateString) {
            try {
                return new Date(dateString).toLocaleDateString('zh-CN');
            } catch {
                return dateString;
            }
        }

        function formatDateString() {
            return new Date().toISOString().split('T')[0];
        }

        function getTagClass(tag) {
            const tagClasses = {
                'dp': 'dp',
                'greedy': 'greedy', 
                'graph': 'graph',
                'math': 'math',
                'string': 'string'
            };
            return tagClasses[tag] || 'default';
        }

        function showNotification(message, type = 'info') {
            const app = window.ACMTransit;
            if (app && app.showGlobalMessage) {
                app.showGlobalMessage(message, type);
            } else {
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
        }

        // æ¨¡æ€æ¡†ç‚¹å‡»å¤–éƒ¨å…³é—­
        document.getElementById('app-info-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAppInfoModal();
            }
        });
    </script>
</body>
</html>